<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Review history of data analysis runs, including status, summaries, and errors.">
    <title>Data Analysis Logs - Data Analysis Tool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="icon" href="https://aionos.io/wp-content/uploads/2024/04/cropped-file-1-32x32.png">
</head>
<body>
    <header class="main-nav-container">
        <nav class="main-nav">
            <a href="{{ url_for('index') }}">New Analysis</a>
            <a href="{{ url_for('analysis_nav') }}">View Analysis Logs</a>
        </nav>
    </header>

    <main class="container page-container">
        <header class="page-header">
            <h1>Analysis Log History</h1>
            <p class="subtitle">Review past data analysis runs comparing datasets with PostgreSQL baselines. Click on a row to see more details.</p>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <ul class="flashes" role="alert">
            {% for category, message in messages %}
              <li class="{{ category }}">{{ message }}</li>
            {% endfor %}
            </ul>
          {% endif %}
        {% endwith %}

        {% if error_message %}
            <section class="card error-card">
                <h2 class="card-title">
                    <span class="emoji">‚ö†Ô∏è</span>
                    Log Retrieval Error
                </h2>
                <p><strong>Error:</strong> {{ error_message }}</p>
                <div class="error-help">
                    <h4>Troubleshooting Steps:</h4>
                    <ol>
                        <li>Check if your PostgreSQL database is running and accessible</li>
                        <li>Verify database connection settings in your .env file</li>
                        <li>Ensure the database user has proper permissions</li>
                        <li>Try running a new analysis to create the log table</li>
                    </ol>
                </div>
                <div class="error-actions">
                    <a href="{{ url_for('index') }}" class="btn btn-primary">
                        <span class="btn-icon">üè†</span>
                        Back to Dashboard
                    </a>
                    <button type="button" class="btn btn-outline" onclick="checkSystemHealth()">
                        <span class="btn-icon">üîç</span>
                        Check System Health
                    </button>
                </div>
            </section>
        {% elif logs %}
            <section class="logs-section">
                <div class="logs-header">
                    <h2 class="section-title">
                        <span class="emoji">üìä</span>
                        Recent Analysis Runs
                        <span class="logs-count">({{ logs|length }} records)</span>
                    </h2>
                </div>

                <div class="table-responsive-wrapper">
                    <table class="log-table table table-striped table-hover">
                        <caption>Overview of recent data analysis pipeline runs. Click rows for details.</caption>
                        <thead>
                            <tr>
                                <th scope="col" class="expand-col">
                                    <span class="sr-only">Expand</span>
                                </th>
                                <th scope="col">Log ID</th>
                                <th scope="col">Date & Time (UTC)</th>
                                <th scope="col">Status</th>
                                <th scope="col">Current Dataset</th>
                                <th scope="col">Historic Table</th>
                                <th scope="col">Summary</th>
                                <th scope="col">Actions</th